!function(a){var b={method:"GET",contentType:"json",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,scrollKeyboard:!1,hintText:null,noResultsText:null,noResultsHideDropdown:!1,searchingText:null,deleteText:"&times;",animateDropdown:!0,emptyInputLength:null,tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",prePopulate:null,processPrePopulate:!1,idPrefix:"token-input-",resultsFormatter:function(a){return"<li>"+a[this.propertyToSearch]+"</li>"},tokenFormatter:function(a){return"<li><p>"+a[this.propertyToSearch]+"</p></li>"},validateItem:null,noHoverSelect:!1,onResult:null,onAdd:null,onDelete:null,onReady:null},c={tokenList:"token-input-list",token:"token-input-token",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token"},d={BEFORE:0,AFTER:1,END:2},e={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},f={init:function(c,d){var e=a.extend({},b,d||{});return this.each(function(){a(this).data("tokenInputObject",new a.TokenList(this,c,e))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(a){return this.data("tokenInputObject").add(a),this},remove:function(a){return this.data("tokenInputObject").remove(a),this},get:function(){return this.data("tokenInputObject").getTokens()}};a.fn.tokenInput=function(a){return f[a]?f[a].apply(this,Array.prototype.slice.call(arguments,1)):f.init.apply(this,arguments)},a.TokenList=function(b,f,g){function h(){var b=a(L).data("tokeninput");return!b&&g.textToData&&(b=g.textToData(H.val())),b?(l(b),I.change(),!1):void 0}function i(){return null!==g.tokenLimit&&F>=g.tokenLimit?(H.hide(),void r()):void 0}function j(){if(D!==(D=H.val())){var a=D.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");P.html(a);var b=30;g.emptyInputLength&&M.children().length<2&&(b=g.emptyInputLength),H.width(P.width()+b)}}function k(b){var c=g.tokenFormatter(b);c=a(c).addClass(g.classes.token).insertBefore(N),a("<span>"+g.deleteText+"</span>").addClass(g.classes.tokenDelete).appendTo(c).click(function(){return p(a(this).parent()),I.change(),!1});var d={id:b.id};return d[g.propertyToSearch]=b[g.propertyToSearch],d.item=b,a.data(c.get(0),"tokeninput",b),E=E.slice(0,K).concat([d]).concat(E.slice(K)),K++,q(E,I),F+=1,null!==g.tokenLimit&&F>=g.tokenLimit&&(H.hide(),r()),c}function l(b){if(b){if(a.isFunction(g.validateItem)&&!g.validateItem(b))return!1;var c=g.onAdd;if(F>0&&g.preventDuplicates){var d=null;if(M.children().each(function(){var c=a(this),e=a.data(c.get(0),"tokeninput");return e&&e.id===b.id?(d=c,!1):void 0}),d)return m(d),N.insertAfter(d),void H.focus()}(null==g.tokenLimit||F<g.tokenLimit)&&(k(b),i()),H.val(""),r(),a.isFunction(c)&&c.call(I,b)}}function m(a){a.addClass(g.classes.selectedToken),J=a.get(0),H.val(""),r()}function n(a,b){a.removeClass(g.classes.selectedToken),J=null,b===d.BEFORE?(N.insertBefore(a),K--):b===d.AFTER?(N.insertAfter(a),K++):(N.appendTo(M),K=F),H.focus()}function o(b){var c=J;J&&n(a(J),d.END),c===b.get(0)?n(b,d.END):m(b)}function p(b){var c=a.data(b.get(0),"tokeninput"),d=g.onDelete,e=b.prevAll().length;e>K&&e--,b.remove(),J=null,H.focus(),E=E.slice(0,e).concat(E.slice(e+1)),K>e&&K--,q(E,I),F-=1,null!==g.tokenLimit&&H.show().val("").focus(),a.isFunction(d)&&d.call(I,c)}function q(b,c){var d=a.map(b,function(a){return a[g.tokenValue]});c.val(d.join(g.tokenDelimiter))}function r(){O.hide().empty(),L=null}function s(){O.css({position:"absolute",top:a(M).offset().top+a(M).outerHeight(),left:a(M).offset().left,zindex:999}).show()}function t(){g.searchingText&&(O.html("<p>"+g.searchingText+"</p>"),s())}function u(){g.hintText&&(O.html("<p>"+g.hintText+"</p>"),s())}function v(b,c){if(c&&c.length){O.empty();var d=a("<ul>").appendTo(O).mouseover(function(b){w(a(b.target).closest("li"))}).mousedown(function(b){return l(a(b.target).closest("li").data("tokeninput")),I.change(),!1}).hide();g.noHoverSelect&&(d.off("mouseover"),d.on("mouseover",function(b){a(this).find("li").removeClass(g.classes.selectedDropdownItem),a(b.target).closest("li").addClass(g.classes.selectedDropdownItem)})),a.each(c,function(b,c){var e=g.resultsFormatter(c);e=a(e).appendTo(d),b%2?e.addClass(g.classes.dropdownItem):e.addClass(g.classes.dropdownItem2),a.data(e.get(0),"tokeninput",c)}),s(),g.animateDropdown?d.slideDown("fast"):d.show()}else g.noResultsText&&(O.html("<p>"+g.noResultsText+"</p>"),s()),g.noResultsHideDropdown&&r()}function w(b,c){if(b){if(L&&x(a(L)),g.scrollKeyboard&&c){var d=a(".token-input-dropdown-tag ul"),e=d.height(),f=b.outerHeight(),h=b.position().top;if(h>e){var i=d.scrollTop();d.scrollTop(i+f)}else if(0>h){var i=d.scrollTop();d.scrollTop(i-f)}}b.addClass(g.classes.selectedDropdownItem),L=b.get(0)}}function x(a){a.removeClass(g.classes.selectedDropdownItem),L=null}function y(){var b=H.val().toLowerCase();(b&&b.length||0==g.minChars)&&(J&&n(a(J),d.AFTER),b.length>=g.minChars?(t(),clearTimeout(C),C=setTimeout(function(){z(b)},g.searchDelay)):r())}function z(b){var c=b+A(),d=G.get(c);if(d)v(b,d);else if(g.url){var e=A(),f={};if(f.data={},e.indexOf("?")>-1){var h=e.split("?");f.url=h[0];var i=h[1].split("&");a.each(i,function(a,b){var c=b.split("=");f.data[c[0]]=c[1]})}else f.url=e;f.data[g.queryParam]=b,f.type=g.method,f.dataType=g.contentType,g.crossDomain&&(f.dataType="jsonp"),f.success=function(d){a.isFunction(g.onResult)&&(d=g.onResult.call(I,d)),G.add(c,g.jsonContainer?d[g.jsonContainer]:d),H.val().toLowerCase()===b&&v(b,g.jsonContainer?d[g.jsonContainer]:d)},a.ajax(f)}else if(g.search_function)g.search_function(b,function(a){G.add(c,a),v(b,a)});else if(g.local_data){var j=a.grep(g.local_data,function(a){return a[g.propertyToSearch].toLowerCase().indexOf(b.toLowerCase())>-1});a.isFunction(g.onResult)&&(j=g.onResult.call(I,j)),G.add(c,j),v(b,j)}}function A(){var a=g.url;return"function"==typeof g.url&&(a=g.url.call()),a}if("string"===a.type(f)||"function"===a.type(f)){g.url=f;var B=A();void 0===g.crossDomain&&(-1===B.indexOf("://")?g.crossDomain=!1:g.crossDomain=location.href.split(/\/+/g)[1]!==B.split(/\/+/g)[1])}else"object"==typeof f&&(g.local_data=f);g.classes?g.classes=a.extend({},c,g.classes):g.theme?(g.classes={},a.each(c,function(a,b){g.classes[a]=b+"-"+g.theme})):g.classes=c;var C,D,E=[],F=0,G=new a.TokenList.Cache,H=a('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",g.idPrefix+b.id).focus(function(){0==g.minChars&&setTimeout(function(){y()},5),(null===g.tokenLimit||g.tokenLimit!==F)&&u()}).blur(function(){h(),r(),a(this).val("")}).bind("keyup keydown blur update",j).keydown(function(b){var c,f;switch(b.keyCode){case e.LEFT:case e.RIGHT:case e.UP:case e.DOWN:if(a(this).val()){if(b.keyCode===e.UP||b.keyCode===e.DOWN){var g=null;return g=L||b.keyCode!==e.DOWN?b.keyCode===e.DOWN?a(L).next():a(L).prev():a(".token-input-dropdown li").first(),g.length?w(g,!0):b.keyCode!==e.DOWN&&a(L).length&&x(a(L)),!1}}else c=N.prev(),f=N.next(),c.length&&c.get(0)===J||f.length&&f.get(0)===J?b.keyCode===e.LEFT||b.keyCode===e.UP?n(a(J),d.BEFORE):n(a(J),d.AFTER):b.keyCode!==e.LEFT&&b.keyCode!==e.UP||!c.length?b.keyCode!==e.RIGHT&&b.keyCode!==e.DOWN||!f.length||m(a(f.get(0))):m(a(c.get(0)));break;case e.BACKSPACE:if(c=N.prev(),!a(this).val().length)return J?(p(a(J)),I.change()):c.length&&m(a(c.get(0))),!1;1===a(this).val().length?r():setTimeout(function(){y()},5);break;case e.TAB:case e.ENTER:case e.NUMPAD_ENTER:case e.COMMA:b.keyCode!=e.ENTER&&b.keyCode!=e.NUMPAD_ENTER&&b.preventDefault(),h();break;case e.ESCAPE:return r(),!0;default:String.fromCharCode(b.which)&&setTimeout(function(){y()},5)}}),I=a(b).hide().val("").focus(function(){H.focus()}).blur(function(){H.blur()}),J=null,K=0,L=null,M=a("<ul />").addClass(g.classes.tokenList).click(function(b){var c=a(b.target).closest("li");c&&c.get(0)&&a.data(c.get(0),"tokeninput")?o(c):(J&&n(a(J),d.END),H.focus())}).mouseover(function(b){var c=a(b.target).closest("li");c&&J!==this&&c.addClass(g.classes.highlightedToken)}).mouseout(function(b){var c=a(b.target).closest("li");c&&J!==this&&c.removeClass(g.classes.highlightedToken)}).insertBefore(I),N=a("<li />").addClass(g.classes.inputToken).appendTo(M).append(H),O=a("<div>").addClass(g.classes.dropdown).appendTo("body").hide(),P=a("<tester/>").insertAfter(H).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:H.css("fontSize"),fontFamily:H.css("fontFamily"),fontWeight:H.css("fontWeight"),letterSpacing:H.css("letterSpacing"),whiteSpace:"nowrap"});I.val("");var Q=g.prePopulate||I.data("pre");g.processPrePopulate&&a.isFunction(g.onResult)&&(Q=g.onResult.call(I,Q)),Q&&Q.length&&a.each(Q,function(a,b){k(b),i()}),a.isFunction(g.onReady)&&(g.onReady.call(),0==g.minChars&&setTimeout(function(){y()},5)),this.clear=function(){M.children("li").each(function(){0===a(this).children("input").length&&p(a(this))})},this.add=function(a){l(a)},this.remove=function(b){M.children("li").each(function(){if(0===a(this).children("input").length){var c=a(this).data("tokeninput"),d=!0;for(var e in b)if(b[e]!==c[e]){d=!1;break}d&&p(a(this))}})},this.getTokens=function(){return E}},a.TokenList.Cache=function(b){var c=a.extend({max_size:500},b),d={},e=0,f=function(){d={},e=0};this.add=function(a,b){e>c.max_size&&f(),d[a]||(e+=1),d[a]=b},this.get=function(a){return d[a]}}}(jQuery);