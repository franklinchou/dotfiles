$(function(){function a(a,b,c,d){var e={identifier:"twitter",action:"addURL",url:c[0].href,title:a+": "+b,actionInfo:{ref_id:d,cxt_ui:"btn_twitter",cxt_url:window.location.href}};sendMessage(e,function(a){})}function b(b,c){$(b).on("click",function(b){if(b.preventDefault(),b.stopPropagation(),!$(this).hasClass("pocket-saved")){$(this).addClass("pocket-saved").find(".icon-pocket").addClass("icon-pocket-saved"),$(this).attr("data-original-title","Saved to Pocket");var d=c.data(this),e=d.username,f=d.text,g=d.links,h=d.tweetId;a(e,f,g,h)}})}function c(){for(var a=q.pocketButtons.length,c=0;a>c;c++){var d=q.pocketButtons[c],e=$(d.container).not(".pocket-inserted"),f=e.length;if(0!==f)for(var g=0;f>g;g++){var h=e[g];if(-1===h.className.indexOf("pocket-inserted")){var i=$(h);i.addClass("pocket-inserted");var j=d.links(i);if(0!==j.length){var k=i.parents(".tweet").attr("data-item-id"),l=d.create(k,d.text,d.className);b($(l).find("a"),d),$(d.after).each(function(a,b){var c=i.find(b);return c.length>0?(c.after(l),!1):void 0})}}}}}function d(){"undefined"==typeof l&&(c(),l=setInterval(c,q.refreshInterval))}function e(){"undefined"!=typeof l&&(clearInterval(l),l=void 0)}function f(){g(),m=setTimeout(function(){d()},500)}function g(){"undefined"!=typeof m&&(clearTimeout(m),m=void 0)}function h(){i(),n=function(){e(),f()},$(window).on("scroll",n)}function i(){"undefined"!=typeof n&&$(window).off("scroll",n)}function j(){addHiddenEventListener(function(){isHidden()?e():d()})}function k(){d(),h(),j()}if(!isSafari()||window.top==window){var l,m,n,o=(window.devicePixelRatio>1,function(a){return a.find("a").not("[data-screen-name]").not(".twitter-atreply").not(".twitter-hashtag")}),p=function(a){var b=0;return"string"==typeof $(a).attr("data-tweet-id")?b=$(a).attr("data-tweet-id"):"string"==typeof $(a).attr("data-item-id")&&(b=$(a).attr("data-item-id")),b},q={refreshInterval:1500,pocketButtons:[{name:"pocket-action",text:"Save to Pocket",container:".js-stream-item .ProfileTweet-actionList, .permalink .ProfileTweet-actionList",after:[".js-toggleRt"],className:"js-tooltip",selector:".pocket-action",create:function(a,b,c){var d=document.createElement("div");d.className="ProfileTweet-action action-pocket-container";var e=document.createElement("a");e.setAttribute("class",c),e.setAttribute("href","#"),e.setAttribute("data-original-title",b);var f=document.createElement("span");return f.setAttribute("class","icon icon-pocket"),$(e).append(f),$(d).append(e),d},links:function(a){var b,c=a.parents("div.tweet");if(c.length)return b=c.find("p.js-tweet-text"),o(b);var d=a.closest(".js-tweet"),e=d.find(".js-tweet-text").first();return b=$(e),o(b)},data:function(a){var b,c,d,e,f,g=$(a),h=g.parents("div.tweet");return h.length?(b=h.find("p.js-tweet-text"),c=h.attr("data-screen-name"),d=b.html().replace(/\n/g," "),e=o(b),f=p(h)):(h=g.closest(".ProfileTweet"),b=h.find("p.js-tweet-text"),c=h.attr("data-screen-name"),d=b.html().replace(/\n/g," "),e=o(b),f=p(h)),{username:c,text:d,links:e,tweetId:f}}}]};addMessageListener(function(a,b,c){"settingChanged"===a.action&&"twitter"===a.key&&("true"===a.value||a.value===!0?k():("false"===a.value||a.value===!1)&&(i(),g(),e()))}),sendMessage({action:"getSetting",key:"twitter"},function(a){("true"===a.value||a.value===!0)&&k()})}});